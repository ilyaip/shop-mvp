# Документ требований: Интеграция с Backend API

## Введение

Интеграция Vue E-commerce приложения с реальным бэкендом API, развернутым на `http://localhost:8000`. Замена моковых данных на реальные API запросы для настроек сайта и товаров. Включает настройку HTTP клиента, обработку ошибок, состояния загрузки и адаптацию существующих компонентов под новую структуру данных.

## Глоссарий

- **Backend_API**: REST API сервер на http://localhost:8000
- **API_Client**: HTTP клиент для взаимодействия с бэкендом (axios)
- **SiteSettings**: Настройки сайта с бэкенда (colors, brand, hero)
- **Product_API**: API для получения списка товаров и деталей товара
- **Active_Product**: Товар с флагом is_site_active: true
- **Error_Handling**: Обработка ошибок API запросов с fallback значениями
- **Loading_State**: Состояние загрузки данных с API

## Требования

### Требование 1: Настройка HTTP клиента

**User Story:** Как разработчик, я хочу иметь настроенный HTTP клиент для взаимодействия с бэкендом, чтобы делать API запросы единообразно.

#### Критерии приемки

1. THE System SHALL создать axios instance с базовым URL `http://localhost:8000`
2. THE System SHALL настроить timeout для запросов (10 секунд)
3. THE System SHALL добавить interceptor для обработки ошибок
4. THE System SHALL добавить interceptor для логирования запросов в development режиме
5. THE System SHALL экспортировать настроенный API клиент из shared/api

### Требование 2: API для настроек сайта

**User Story:** Как пользователь, я хочу видеть настройки сайта загруженные с бэкенда, чтобы видеть актуальную тему и брендинг.

#### Критерии приемки

1. THE System SHALL создать API функцию для запроса `/dev-api/site-settings/active`
2. WHEN запрос успешен, THE System SHALL преобразовать snake_case поля в camelCase
3. THE System SHALL преобразовать структуру colors с snake_case ключами в camelCase
4. THE System SHALL преобразовать структуру brand с snake_case ключами в camelCase
5. THE System SHALL преобразовать структуру hero с snake_case ключами в camelCase (cta_text → ctaText)
6. WHEN запрос завершается ошибкой, THE System SHALL использовать fallback на дефолтную тему
7. THE System SHALL логировать ошибки загрузки настроек в консоль

### Требование 3: API для списка товаров

**User Story:** Как пользователь, я хочу видеть товары загруженные с бэкенда, чтобы просматривать актуальный каталог.

#### Критерии приемки

1. THE System SHALL создать API функцию для запроса `/dev-api/product/list`
2. WHEN запрос успешен, THE System SHALL фильтровать товары по is_site_active: true
3. THE System SHALL преобразовать поля товара из бэкенда в формат приложения:
   - name → title
   - primary_image → image
   - Остальные поля сохранить
4. THE System SHALL сохранять total количество товаров из ответа
5. WHEN запрос завершается ошибкой, THE System SHALL использовать fallback на пустой массив
6. THE System SHALL отображать состояние загрузки во время запроса

### Требование 4: API для деталей товара

**User Story:** Как пользователь, я хочу видеть детальную информацию о товаре с бэкенда, чтобы принять решение о покупке.

#### Критерии приемки

1. THE System SHALL создать API функцию для запроса `/dev-api/product/{product_id}`
2. WHEN запрос успешен, THE System SHALL преобразовать поля товара в формат приложения
3. WHEN товар не найден (404), THE System SHALL показывать сообщение "Товар не найден"
4. WHEN запрос завершается ошибкой, THE System SHALL показывать сообщение об ошибке
5. THE System SHALL отображать состояние загрузки во время запроса

### Требование 5: Обновление useThemeStore

**User Story:** Как пользователь, я хочу чтобы тема загружалась с бэкенда, чтобы видеть актуальные настройки администратора.

#### Критерии приемки

1. THE System SHALL обновить loadSettings в useThemeStore для использования API вместо моковых данных
2. WHEN настройки загружены, THE System SHALL применять их через applyTheme
3. WHEN загрузка завершается ошибкой, THE System SHALL применять дефолтную светлую тему
4. THE System SHALL устанавливать isLoading: true во время загрузки
5. THE System SHALL устанавливать isLoading: false после завершения загрузки
6. THE System SHALL сохранять информацию об ошибке в state для отладки

### Требование 6: Обновление useProductsStore

**User Story:** Как пользователь, я хочу чтобы товары загружались с бэкенда, чтобы видеть актуальный каталог.

#### Критерии приемки

1. THE System SHALL обновить useProductsStore для загрузки товаров через API
2. THE System SHALL создать action loadProducts для загрузки списка товаров
3. WHEN товары загружены, THE System SHALL сохранять их в state
4. WHEN загрузка завершается ошибкой, THE System SHALL сохранять пустой массив
5. THE System SHALL устанавливать isLoading: true во время загрузки
6. THE System SHALL устанавливать isLoading: false после завершения загрузки
7. THE System SHALL вызывать loadProducts при инициализации store

### Требование 7: Обновление getProductById

**User Story:** Как пользователь, я хочу видеть детальную информацию о товаре с бэкенда на странице товара.

#### Критерии приемки

1. THE System SHALL обновить getProductById для загрузки товара через API
2. WHEN товар найден в state, THE System SHALL возвращать его без API запроса
3. WHEN товар не найден в state, THE System SHALL делать API запрос
4. WHEN API запрос успешен, THE System SHALL добавлять товар в state
5. WHEN API запрос завершается ошибкой, THE System SHALL возвращать null

### Требование 8: Обработка состояний загрузки

**User Story:** Как пользователь, я хочу видеть индикаторы загрузки, чтобы понимать что данные загружаются.

#### Критерии приемки

1. THE System SHALL отображать скелетоны на CatalogPage во время загрузки товаров
2. THE System SHALL отображать скелетон на ProductPage во время загрузки товара
3. THE System SHALL отображать индикатор загрузки на LandingPage во время загрузки настроек
4. WHEN данные загружены, THE System SHALL скрывать индикаторы загрузки
5. THE System SHALL обеспечить плавный переход от загрузки к контенту

### Требование 9: Обработка ошибок API

**User Story:** Как пользователь, я хочу видеть понятные сообщения об ошибках, когда что-то идет не так.

#### Критерии приемки

1. WHEN API запрос завершается с ошибкой сети, THE System SHALL показывать "Ошибка подключения к серверу"
2. WHEN API запрос завершается с 404, THE System SHALL показывать "Данные не найдены"
3. WHEN API запрос завершается с 500, THE System SHALL показывать "Ошибка сервера"
4. WHEN API запрос завершается с timeout, THE System SHALL показывать "Превышено время ожидания"
5. THE System SHALL логировать все ошибки API в консоль для отладки
6. THE System SHALL использовать fallback значения при ошибках для продолжения работы приложения

### Требование 10: Преобразование данных

**User Story:** Как разработчик, я хочу иметь утилиты для преобразования данных между форматами бэкенда и фронтенда.

#### Критерии приемки

1. THE System SHALL создать утилиту для преобразования snake_case в camelCase
2. THE System SHALL создать утилиту для преобразования структуры Product из API в формат приложения
3. THE System SHALL создать утилиту для преобразования структуры SiteSettings из API в формат приложения
4. THE System SHALL обеспечить типобезопасность преобразований через TypeScript
5. THE System SHALL обрабатывать отсутствующие поля с дефолтными значениями

### Требование 11: Удаление моковых данных

**User Story:** Как разработчик, я хочу удалить моковые данные после успешной интеграции с API.

#### Критерии приемки

1. THE System SHALL удалить файл shared/api/mock-data.ts после успешной интеграции
2. THE System SHALL удалить моковые данные тем из shared/api/theme-data.ts
3. THE System SHALL сохранить функцию getPresetTheme для ThemeSwitcher (демо режим)
4. THE System SHALL обновить все импорты моковых данных на API вызовы
5. THE System SHALL обеспечить работоспособность приложения без моковых данных

### Требование 12: Конфигурация окружения

**User Story:** Как разработчик, я хочу иметь возможность настраивать URL бэкенда через переменные окружения.

#### Критерии приемки

1. THE System SHALL создать .env файл с переменной VITE_API_BASE_URL
2. THE System SHALL использовать VITE_API_BASE_URL в axios instance
3. THE System SHALL предоставить дефолтное значение http://localhost:8000
4. THE System SHALL создать .env.example с примером конфигурации
5. THE System SHALL добавить .env в .gitignore

### Требование 13: CORS и безопасность

**User Story:** Как разработчик, я хочу обеспечить безопасное взаимодействие с бэкендом.

#### Критерии приемки

1. THE System SHALL настроить axios для работы с CORS
2. THE System SHALL добавить withCredentials: false для локальной разработки
3. THE System SHALL добавить заголовок Content-Type: application/json
4. THE System SHALL обрабатывать CORS ошибки с понятными сообщениями
5. THE System SHALL документировать требования к CORS настройкам бэкенда

### Требование 14: Кэширование данных

**User Story:** Как пользователь, я хочу чтобы приложение работало быстро и не делало лишних запросов.

#### Критерии приемки

1. THE System SHALL кэшировать настройки сайта в памяти после первой загрузки
2. THE System SHALL кэшировать список товаров в памяти
3. THE System SHALL кэшировать детали товаров в памяти
4. THE System SHALL предоставить возможность принудительного обновления данных
5. THE System SHALL не делать повторные запросы для уже загруженных данных

### Требование 15: Обратная совместимость

**User Story:** Как разработчик, я хочу сохранить работоспособность всех существующих фич при интеграции с API.

#### Критерии приемки

1. THE System SHALL сохранить работу корзины (localStorage)
2. THE System SHALL сохранить работу заказов (localStorage)
3. THE System SHALL сохранить работу фильтрации товаров
4. THE System SHALL сохранить работу всех страниц
5. THE System SHALL сохранить работу всех существующих тестов
